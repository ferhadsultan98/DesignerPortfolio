<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xərc İdarəetmə Sistemi</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        /* Ümumi Stilizasiya və Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            display: flex;
            overflow-x: hidden; /* Yan scroll barı aradan qaldırmaq */
        }

        /* Yan Panel (Sidebar) */
        .sidebarMenu {
            width: 260px;
            height: 100vh;
            background-color: #2c3e50; /* Tünd göy-qara */
            color: #ecf0f1; /* Açıq boz */
            padding: 25px 15px;
            position: fixed;
            top: 0;
            left: 0;
            overflow-y: auto;
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
        }

        .sidebarMenu.menuCollapsed {
            transform: translateX(-100%);
        }

        .sidebarMenu .siteLogo {
            font-size: 1.8em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
            color: #3498db; /* Parlaq göy */
            cursor: pointer;
        }

        .sidebarMenu .balansInfo {
            margin-bottom: 30px;
            padding: 15px;
            background-color: #34495e; /* Biraz daha açıq tünd göy */
            border-radius: 8px;
            text-align: center;
        }

        .sidebarMenu .balansInfo h3 {
            font-size: 1.1em;
            margin-bottom: 8px;
            color: #bdc3c7; /* Boz */
        }

        .sidebarMenu .balansInfo #cariBalans {
            font-size: 1.6em;
            font-weight: bold;
            color: #2ecc71; /* Yaşıl */
        }

        .sidebarMenu .menuList {
            list-style: none;
        }

        .sidebarMenu .menuList .menuItem a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #ecf0f1;
            text-decoration: none;
            border-radius: 6px;
            margin-bottom: 8px;
            transition: background-color 0.3s, color 0.3s;
        }

        .sidebarMenu .menuList .menuItem a:hover,
        .sidebarMenu .menuList .menuItem a.active {
            background-color: #3498db; /* Aktiv/Hover üçün parlaq göy */
            color: #fff;
        }

        .sidebarMenu .menuList .menuItem a svg {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Əsas Kontent Sahəsi */
        .mainContentContainer {
            margin-left: 260px; /* Sidebar genişliyi qədər */
            padding: 25px;
            width: calc(100% - 260px);
            transition: margin-left 0.3s ease-in-out, width 0.3s ease-in-out;
            overflow-y: auto;
            height: 100vh;
        }

        .mainContentContainer.fullWidth {
            margin-left: 0;
            width: 100%;
        }

        .pageContent {
            display: none; /* Başlanğıcda bütün səhifələr gizli */
            background-color: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease-in-out;
        }

        .pageContent.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pageHeader {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        /* Form elementləri üçün ümumi stil */
        .formGroup {
            margin-bottom: 20px;
        }

        .formGroup label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .formGroup input[type="text"],
        .formGroup input[type="number"],
        .formGroup input[type="date"],
        .formGroup select,
        .formGroup textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .formGroup input:focus,
        .formGroup select:focus,
        .formGroup textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .formGroup textarea {
            resize: vertical;
            min-height: 100px;
        }

        .primaryButton {
            background-color: #3498db;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }

        .primaryButton:hover {
            background-color: #2980b9; /* Biraz daha tünd göy */
        }

        /* Cədvəl Stilizasiyası */
        .dataGostericiCedvel {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .dataGostericiCedvel th,
        .dataGostericiCedvel td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .dataGostericiCedvel th {
            background-color: #3498db; /* Parlaq göy */
            color: white;
            font-weight: bold;
        }

        .dataGostericiCedvel tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .dataGostericiCedvel tbody tr:hover {
            background-color: #eaf4f9; /* Açıq mavi hover */
        }

        /* Statistika Səhifəsi Kartları */
        .statistikaKartlari {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .statKart {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
        }

        .statKart h4 {
            margin-bottom: 10px;
            color: #34495e;
            font-size: 1.1em;
        }

        .statKart .statDeyer {
            font-size: 1.8em;
            font-weight: bold;
            color: #3498db;
        }

        /* Xərcləri Azaltmaq Səhifəsi */
        .azaltmaTeqlifi {
            background-color: #e8f6fd;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid #3498db;
            border-radius: 5px;
        }
        .azaltmaTeqlifi h4 {
            color: #2980b9;
            margin-bottom: 8px;
        }

        /* AI Köməkçi Düyməsi */
        .aiKomekciBtn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: #e74c3c; /* Qırmızıya çalan */
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, transform 0.3s;
            z-index: 1001;
        }

        .aiKomekciBtn:hover {
            background-color: #c0392b; /* Tünd qırmızı */
            transform: scale(1.1);
        }

        /* AI Köməkçi Pəncərəsi */
        .aiKomekciPenceresi {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 320px;
            max-height: 400px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.25);
            padding: 20px;
            display: none; /* Başlanğıcda gizli */
            flex-direction: column;
            z-index: 1000;
            animation: slideUpFadeIn 0.3s ease-out;
        }

        @keyframes slideUpFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }


        .aiKomekciPenceresi.goster {
            display: flex;
        }

        .aiKomekciPenceresi h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .aiKomekciPenceresi #aiMeslehetKontent {
            overflow-y: auto;
            font-size: 0.9em;
            color: #555;
        }
         .aiKomekciPenceresi #aiMeslehetKontent p {
            margin-bottom:10px;
         }
         .aiKomekciPenceresi #aiMeslehetKontent strong {
            color: #3498db;
         }


        /* Mobil Cihazlar üçün Menyunu Aç/Bağla Düyməsi */
        .menuToggleBtn {
            display: none; /* Böyük ekranlarda gizli */
            position: fixed;
            top: 15px;
            left: 15px;
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px;
            font-size: 20px;
            cursor: pointer;
            z-index: 1002;
            border-radius: 5px;
        }

        /* Responsive Dizayn */
        @media (max-width: 768px) {
            .sidebarMenu {
                transform: translateX(-100%); /* Kiçik ekranlarda başlanğıcda gizli */
            }

            .sidebarMenu.menuVisible {
                transform: translateX(0);
            }

            .mainContentContainer {
                margin-left: 0;
                width: 100%;
            }

            .menuToggleBtn {
                display: block; /* Kiçik ekranlarda göstər */
            }

            .aiKomekciBtn {
                width: 50px;
                height: 50px;
                font-size: 20px;
                bottom: 20px;
                right: 20px;
            }
            .aiKomekciPenceresi {
                width: calc(100% - 40px);
                right: 20px;
                bottom: 80px;
            }
        }

    </style>
</head>
<body>

    <button class="menuToggleBtn" id="menuToggleBtn">☰</button>

    <aside class="sidebarMenu" id="sidebarMenu">
        <div class="siteLogo">Xərcim.az</div>
        <div class="balansInfo">
            <h3>Cari Balansınız</h3>
            <div id="cariBalans">0.00 AZN</div>
        </div>
        <ul class="menuList">
            <li class="menuItem"><a href="#statistika" class="navLink active" data-page="statistikaPage">
                <svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z" fill-opacity="0"/><path d="M4 18h2V8H4v10zm4 0h2V4H8v14zm4 0h2V12h-2v6zm4 0h2V6h-2v12z"/></svg>
                Statistika
            </a></li>
            <li class="menuItem"><a href="#xerclikElaveEt" class="navLink" data-page="xerclikElaveEtPage">
                <svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z" fill-opacity="0"/><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                Xərclik Əlavə Et
            </a></li>
            <li class="menuItem"><a href="#xerclikCedveli" class="navLink" data-page="xerclikCedveliPage">
                <svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z" fill-opacity="0"/><path d="M8 4h8v2H8zM4 8h16v12H4zm2 2v8h12v-8H6zm2 2h2v4H8zm4 0h2v4h-2z"/></svg>
                Xərclik Cədvəli
            </a></li>
            <li class="menuItem"><a href="#xercleriAzalt" class="navLink" data-page="xercleriAzaltPage">
                <svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z" fill-opacity="0"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>
                Xərcləri Azaltmaq
            </a></li>
            <li class="menuItem"><a href="#saytHaqqinda" class="navLink" data-page="saytHaqqindaPage">
                <svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z" fill-opacity="0"/><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
                Sayt Haqqında
            </a></li>
        </ul>
    </aside>

    <main class="mainContentContainer" id="mainContentContainer">
        <section id="statistikaPage" class="pageContent active">
            <h2 class="pageHeader">Xərclik Statistikası</h2>
            <div class="statistikaKartlari">
                <div class="statKart">
                    <h4>Ümumi Xərc</h4>
                    <p class="statDeyer" id="umumiXercStat">0.00 AZN</p>
                </div>
                <div class="statKart">
                    <h4>Bu Ayki Xərc</h4>
                    <p class="statDeyer" id="buAykiXercStat">0.00 AZN</p>
                </div>
                <div class="statKart">
                    <h4>Ən Çox Xərclənən Kateqoriya</h4>
                    <p class="statDeyer" id="enCoxXercKatStat">-</p>
                </div>
                 <div class="statKart">
                    <h4>Gündəlik Ortalama Xərc</h4>
                    <p class="statDeyer" id="gundelikOrtalamaXercStat">0.00 AZN</p>
                </div>
            </div>
            <p>Detallı xərc analizi və qrafiklər burada göstəriləcəkdir. Məsələn, xərclərin kateqoriyalara görə paylanması, zamanla xərc dəyişiklikləri və s.</p>
            <canvas id="xerclikQrafiki" style="max-width: 100%; margin-top: 20px;"></canvas>

        </section>

        <section id="xerclikElaveEtPage" class="pageContent">
            <h2 class="pageHeader">Yeni Xərclik Əlavə Et</h2>
            <form id="xerclikForma">
                <div class="formGroup">
                    <label for="xerclikMiqdari">Məbləğ (AZN)</label>
                    <input type="number" id="xerclikMiqdari" placeholder="Məs: 50.00" required step="0.01">
                </div>
                <div class="formGroup">
                    <label for="xerclikKateqoriya">Kateqoriya</label>
                    <select id="xerclikKateqoriya" required>
                        <option value="">Kateqoriya seçin...</option>
                        <option value="qida">Qida</option>
                        <option value="neqliyyat">Nəqliyyat</option>
                        <option value="kommunal">Kommunal Xərclər</option>
                        <option value="eylence">Əyləncə</option>
                        <option value="geyim">Geyim</option>
                        <option value="saglamliq">Sağlamlıq</option>
                        <option value="tehsil">Təhsil</option>
                        <option value="diger">Digər</option>
                    </select>
                </div>
                <div class="formGroup">
                    <label for="xerclikTarix">Tarix</label>
                    <input type="date" id="xerclikTarix" required>
                </div>
                <div class="formGroup">
                    <label for="xerclikQeyd">Qeyd (İstəyə Bağlı)</label>
                    <textarea id="xerclikQeyd" placeholder="Xərc haqqında əlavə məlumat..."></textarea>
                </div>
                <button type="submit" class="primaryButton">Xərcliyi Əlavə Et</button>
            </form>
        </section>

        <section id="xerclikCedveliPage" class="pageContent">
            <h2 class="pageHeader">Xərclik Cədvəli</h2>
            <div class="formGroup">
                <input type="text" id="cedvelAxtaris" placeholder="Axtarış (məbləğ, kateqoriya, qeyd...)">
            </div>
            <table class="dataGostericiCedvel">
                <thead>
                    <tr>
                        <th>Məbləğ (AZN)</th>
                        <th>Kateqoriya</th>
                        <th>Tarix</th>
                        <th>Qeyd</th>
                        <th>Əməliyyatlar</th>
                    </tr>
                </thead>
                <tbody id="xerclikCedveliBody">
                    </tbody>
            </table>
        </section>

        <section id="xercleriAzaltPage" class="pageContent">
            <h2 class="pageHeader">Xərcləri Azaltmağın Yolları</h2>
            <p>Maliyyə vəziyyətinizi yaxşılaşdırmaq və pulunuza qənaət etmək üçün bəzi təkliflər:</p>
            <br>
            <div class="azaltmaTeqlifi">
                <h4>1. Büdcə Yaradın və İzləyin</h4>
                <p>Aylıq gəlir və xərclərinizi dəqiq qeyd edin. Hansı sahələrə nə qədər pul xərclədiyinizi bilmək, qənaət üçün ilk addımdır.</p>
            </div>
            <div class="azaltmaTeqlifi">
                <h4>2. Prioritetləri Müəyyənləşdirin</h4>
                <p>İstəklərinizlə ehtiyaclarınızı ayırd edin. Zəruri olmayan xərcləri azaldın və ya təxirə salın.</p>
            </div>
            <div class="azaltmaTeqlifi">
                <h4>3. Borclarınızı Azaldın</h4>
                <p>Yüksək faizli kredit kartı borcları və ya digər borclar varsa, onları ödəmək üçün bir plan qurun. Faiz xərcləri büdcənizə ciddi təsir edə bilər.</p>
            </div>
            <div class="azaltmaTeqlifi">
                <h4>4. Avtomatik Qənaət Hesabı Açın</h4>
                <p>Hər ay maaşınızdan müəyyən bir məbləğin avtomatik olaraq qənaət hesabınıza köçürülməsini təmin edin.</p>
            </div>
             <div class="azaltmaTeqlifi">
                <h4>5. Ağıllı Alış-veriş Edin</h4>
                <p>Endirimlərdən yararlanın, qiymətləri müqayisə edin və impulsiv alış-verişdən çəkinin. Alış-verişə getməzdən əvvəl siyahı hazırlayın.</p>
            </div>
            <div class="azaltmaTeqlifi">
                <h4>6. Evdə Yemək Hazırlayın</h4>
                <p>Restoran və kafelərdə yemək əvəzinə evdə yemək hazırlamaq xərclərinizi əhəmiyyətli dərəcədə azalda bilər.</p>
            </div>
             <div class="azaltmaTeqlifi">
                <h4>7. Abunəliklərinizi Gözdən Keçirin</h4>
                <p>İstifadə etmədiyiniz və ya az istifadə etdiyiniz abunəlikləri (jurnal, TV kanalları, proqramlar və s.) ləğv edin.</p>
            </div>
             <div class="azaltmaTeqlifi">
                <h4>8. Enerjiyə Qənaət Edin</h4>
                <p>İşıqları söndürün, enerjiyə qənaət edən cihazlardan istifadə edin. Bu, kommunal xərclərinizi azaldacaq.</p>
            </div>
        </section>

        <section id="saytHaqqindaPage" class="pageContent">
            <h2 class="pageHeader">Sayt Haqqında</h2>
            <p><strong>Xərcim.az</strong> - şəxsi maliyyə və xərclərinizi asanlıqla idarə etmək üçün yaradılmış müasir bir veb tətbiqidir.</p>
            <p>Bu platforma vasitəsilə siz gündəlik, aylıq xərclərinizi qeyd edə, onları kateqoriyalara görə təsnifləndirə, xərc statistikanızı izləyə və pulunuza qənaət etmək üçün faydalı məsləhətlər əldə edə bilərsiniz.</p>
            <h4>Əsas Xüsusiyyətlər:</h4>
            <ul>
                <li><strong>Xərclərin Qeydiyyatı:</strong> Sadə və intuitiv interfeyslə yeni xərclər əlavə edin.</li>
                <li><strong>Kateqorizasiya:</strong> Xərclərinizi (qida, nəqliyyat, kommunal və s.) daha yaxşı analiz üçün təsnifləndirin.</li>
                <li><strong>Statistika və Analiz:</strong> Xərcləriniz haqqında detallı statistika, qrafiklər və hesabatlar əldə edin.</li>
                <li><strong>Balans İdarəetməsi:</strong> Cari maliyyə balansınızı izləyin.</li>
                <li><strong>Qənaət Məsləhətləri:</strong> Büdcənizi optimallaşdırmaq və xərcləri azaltmaq üçün praktiki tövsiyələr.</li>
                <li><strong>AI Köməkçi:</strong> Xərc vərdişlərinizə əsaslanaraq fərdi qənaət məsləhətləri verən ağıllı köməkçi.</li>
                <li><strong>Tam Responsive Dizayn:</strong> İstənilən cihazda (kompüter, planşet, mobil telefon) rahat istifadə.</li>
            </ul>
            <p>Məqsədimiz, maliyyə savadlılığınızı artırmaq və maliyyə hədəflərinizə çatmağınıza kömək etməkdir.</p>
            <br>
            <p><em>Bu sayt istifadəçi məlumatlarının məxfiliyini və təhlükəsizliyini təmin edir. Bütün məlumatlar lokal olaraq brauzerinizdə saxlanılır və heç bir serverə göndərilmir (bu demo versiyası üçün).</em></p>
            <p>Hazırladı: [Adınız və ya Şirkət Adınız]</p>
            <p>Tarix: May 2025</p>
        </section>
    </main>

    <button class="aiKomekciBtn" id="aiKomekciBtn" title="AI Köməkçi">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="28" height="28" fill="white"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10c5.515 0 10-4.486 10-10S17.515 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/><path d="M12 6c-1.654 0-3 1.346-3 3s1.346 3 3 3 3-1.346 3-3-1.346-3-3-3zm0 7c-2.757 0-5 2.243-5 5h10c0-2.757-2.243-5-5-5z"/></svg>
    </button>

    <div class="aiKomekciPenceresi" id="aiKomekciPenceresi">
        <h4>AI Maliyyə Məsləhətçisi</h4>
        <div id="aiMeslehetKontent">
            <p>Salam! Mən sizin maliyyə köməkçinizəm. Xərclərinizi analiz edərək sizə qənaət etmək üçün fərdi məsləhətlər verə bilərəm.</p>
            <p>Hazırda aktiv səhifə və ya xərcləriniz haqqında məlumat toplamağa çalışıram...</p>
        </div>
    </div>


    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.navLink');
            const pageContents = document.querySelectorAll('.pageContent');
            const xerclikForma = document.getElementById('xerclikForma');
            const cariBalansElement = document.getElementById('cariBalans');
            const xerclikCedveliBody = document.getElementById('xerclikCedveliBody');
            const menuToggleBtn = document.getElementById('menuToggleBtn');
            const sidebarMenu = document.getElementById('sidebarMenu');
            const mainContentContainer = document.getElementById('mainContentContainer');
            const aiKomekciBtn = document.getElementById('aiKomekciBtn');
            const aiKomekciPenceresi = document.getElementById('aiKomekciPenceresi');
            const aiMeslehetKontent = document.getElementById('aiMeslehetKontent');

            const umumiXercStatElement = document.getElementById('umumiXercStat');
            const buAykiXercStatElement = document.getElementById('buAykiXercStat');
            const enCoxXercKatStatElement = document.getElementById('enCoxXercKatStat');
            const gundelikOrtalamaXercStatElement = document.getElementById('gundelikOrtalamaXercStat');
            const xerclikTarixInput = document.getElementById('xerclikTarix');
            const cedvelAxtarisInput = document.getElementById('cedvelAxtaris');

            let xerclikler = JSON.parse(localStorage.getItem('xercliklerData')) || [];
            let cariBalans = parseFloat(localStorage.getItem('cariBalansData')) || 1000.00; // Başlanğıc balans

            // Funksiyalar
            function sehifeGoster(pageId) {
                pageContents.forEach(page => {
                    page.classList.remove('active');
                });
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === pageId) {
                        link.classList.add('active');
                    }
                });
                const aktivSehife = document.getElementById(pageId);
                if (aktivSehife) {
                    aktivSehife.classList.add('active');
                }
                // AI pəncərəsini bağla
                aiKomekciPenceresi.classList.remove('goster');
            }

            function balansYenile() {
                cariBalansElement.textContent = `${cariBalans.toFixed(2)} AZN`;
                localStorage.setItem('cariBalansData', cariBalans.toString());
            }

            function xerclikleriYaddaSaxla() {
                localStorage.setItem('xercliklerData', JSON.stringify(xerclikler));
            }

            function bildirisGoster(mesaj, type = 'success') {
                Toastify({
                    text: mesaj,
                    duration: 3000,
                    close: true,
                    gravity: "top", // `top` or `bottom`
                    position: "right", // `left`, `center` or `right`
                    backgroundColor: type === 'success' ? "linear-gradient(to right, #00b09b, #96c93d)" : "linear-gradient(to right, #ff5f6d, #ffc371)",
                }).showToast();
            }

            function xerclikCedveliniYenile(filterData = xerclikler) {
                xerclikCedveliBody.innerHTML = ''; // Cədvəli təmizlə
                filterData.sort((a,b) => new Date(b.tarix) - new Date(a.tarix)); // Tarixə görə sırala (ən yeni birinci)

                if (filterData.length === 0) {
                    const tr = document.createElement('tr');
                    const td = document.createElement('td');
                    td.colSpan = 5;
                    td.textContent = 'Heç bir xərc tapılmadı.';
                    td.style.textAlign = 'center';
                    tr.appendChild(td);
                    xerclikCedveliBody.appendChild(tr);
                    return;
                }

                filterData.forEach((xerc, index) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${parseFloat(xerc.miqdar).toFixed(2)} AZN</td>
                        <td>${xerc.kateqoriya}</td>
                        <td>${new Date(xerc.tarix).toLocaleDateString('az-AZ')}</td>
                        <td>${xerc.qeyd || '-'}</td>
                        <td><button class="primaryButton deleteBtn" style="background-color:#e74c3c" data-index="${index}">Sil</button></td>
                    `;
                    xerclikCedveliBody.appendChild(tr);
                });

                // Silmə düymələrinə event listener əlavə et
                document.querySelectorAll('.deleteBtn').forEach(button => {
                    button.addEventListener('click', function() {
                        const xercIndex = parseInt(this.dataset.index);
                        // Axtarış aktivdirsə, original `xerclikler` array-dəki doğru indeksi tapmaq lazımdır
                        const originalIndex = xerclikler.findIndex(x => x.id === filterData[xercIndex].id);
                        if (originalIndex > -1) {
                           const silinecekXerc = xerclikler[originalIndex];
                           cariBalans += parseFloat(silinecekXerc.miqdar); // Silinən məbləği balansa geri qaytar
                           xerclikler.splice(originalIndex, 1);
                           xerclikleriYaddaSaxla();
                           balansYenile();
                           xerclikCedveliniYenile(getFilteredData()); // Cədvəli filtrlənmiş data ilə yenilə
                           statistikaYenile();
                           bildirisGoster('Xərc uğurla silindi!', 'success');
                        }
                    });
                });
            }

             function getFilteredData() {
                const axtarisSozu = cedvelAxtarisInput.value.toLowerCase();
                if (!axtarisSozu) return xerclikler;

                return xerclikler.filter(xerc =>
                    xerc.miqdar.toString().includes(axtarisSozu) ||
                    xerc.kateqoriya.toLowerCase().includes(axtarisSozu) ||
                    (xerc.qeyd && xerc.qeyd.toLowerCase().includes(axtarisSozu)) ||
                    new Date(xerc.tarix).toLocaleDateString('az-AZ').includes(axtarisSozu)
                );
            }


            function statistikaYenile() {
                let umumiXerc = 0;
                let buAykiXerc = 0;
                const kateqoriyaXercleri = {};
                const buGun = new Date();
                const buAy = buGun.getMonth();
                const buIl = buGun.getFullYear();

                let toplamGunSayi = 0;
                let ilkXercTarixi = null;

                if (xerclikler.length > 0) {
                    ilkXercTarixi = new Date(Math.min(...xerclikler.map(x => new Date(x.tarix))));
                    const buGunDateOnly = new Date(buGun.getFullYear(), buGun.getMonth(), buGun.getDate());
                    const ilkXercDateOnly = new Date(ilkXercTarixi.getFullYear(), ilkXercTarixi.getMonth(), ilkXercTarixi.getDate());
                    toplamGunSayi = Math.max(1, Math.ceil((buGunDateOnly - ilkXercDateOnly) / (1000 * 60 * 60 * 24)) + 1);
                }


                xerclikler.forEach(xerc => {
                    const miqdar = parseFloat(xerc.miqdar);
                    umumiXerc += miqdar;

                    const xercTarixi = new Date(xerc.tarix);
                    if (xercTarixi.getMonth() === buAy && xercTarixi.getFullYear() === buIl) {
                        buAykiXerc += miqdar;
                    }

                    if (kateqoriyaXercleri[xerc.kateqoriya]) {
                        kateqoriyaXercleri[xerc.kateqoriya] += miqdar;
                    } else {
                        kateqoriyaXercleri[xerc.kateqoriya] = miqdar;
                    }
                });

                umumiXercStatElement.textContent = `${umumiXerc.toFixed(2)} AZN`;
                buAykiXercStatElement.textContent = `${buAykiXerc.toFixed(2)} AZN`;

                let enCoxXercKat = '-';
                let maxKatXerc = 0;
                for (const kat in kateqoriyaXercleri) {
                    if (kateqoriyaXercleri[kat] > maxKatXerc) {
                        maxKatXerc = kateqoriyaXercleri[kat];
                        enCoxXercKat = kat.charAt(0).toUpperCase() + kat.slice(1); // İlk hərfi böyük
                    }
                }
                enCoxXercKatStatElement.textContent = enCoxXercKat;

                const gundelikOrtalamaXerc = toplamGunSayi > 0 ? (umumiXerc / toplamGunSayi) : 0;
                gundelikOrtalamaXercStatElement.textContent = `${gundelikOrtalamaXerc.toFixed(2)} AZN`;

                // Qrafiki yenilə
                xerclikQrafikiGuncelle(kateqoriyaXercleri);
            }

            // Xərclik Əlavə Etmə Forması
            if (xerclikForma) {
                xerclikForma.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const miqdar = parseFloat(document.getElementById('xerclikMiqdari').value);
                    const kateqoriya = document.getElementById('xerclikKateqoriya').value;
                    const tarix = document.getElementById('xerclikTarix').value;
                    const qeyd = document.getElementById('xerclikQeyd').value;

                    if (isNaN(miqdar) || miqdar <= 0 || !kateqoriya || !tarix) {
                        bildirisGoster('Zəhmət olmasa bütün tələb olunan xanaları düzgün doldurun.', 'error');
                        return;
                    }

                    if (miqdar > cariBalans) {
                        bildirisGoster('Balansınızda kifayət qədər vəsait yoxdur!', 'error');
                        return;
                    }
                    const yeniXerc = {
                        id: Date.now(), // Unikal ID
                        miqdar: miqdar,
                        kateqoriya: kateqoriya,
                        tarix: tarix,
                        qeyd: qeyd
                    };

                    xerclikler.push(yeniXerc);
                    cariBalans -= miqdar;

                    xerclikleriYaddaSaxla();
                    balansYenile();
                    xerclikCedveliniYenile(getFilteredData());
                    statistikaYenile();

                    bildirisGoster('Xərclik uğurla əlavə edildi!', 'success');
                    xerclikForma.reset(); // Formanı təmizlə
                    // Tarix inputunu bugünkü tarixə resetlə
                    document.getElementById('xerclikTarix').valueAsDate = new Date();
                });
            }

            // Səhifə Naviqasiyası
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.dataset.page;
                    sehifeGoster(pageId);
                    history.pushState(null, '', this.href); // URL-i dəyişdir

                    // Mobil görünüşdə menyunu bağla
                    if (window.innerWidth <= 768) {
                        sidebarMenu.classList.remove('menuVisible');
                        mainContentContainer.classList.remove('fullWidth'); // Bunu yoxla, əslində margin qayıtmalı
                        if (!sidebarMenu.classList.contains('menuVisible')) {
                           mainContentContainer.style.marginLeft = '0px';
                        } else {
                           mainContentContainer.style.marginLeft = '260px';
                        }
                    }
                });
            });

             // URL hash dəyişdikdə (geri/irəli düymələri)
            window.addEventListener('popstate', function() {
                const currentHash = window.location.hash.substring(1);
                let pageToLoad = 'statistikaPage'; // default
                if (currentHash) {
                     const targetLink = document.querySelector(`.navLink[href="#${currentHash}"]`);
                     if (targetLink) {
                        pageToLoad = targetLink.dataset.page;
                     }
                }
                sehifeGoster(pageToLoad);
            });

            // Başlanğıcda URL hash-ə uyğun səhifəni göstər
            function baslangicSehifesiniYukle() {
                const currentHash = window.location.hash.substring(1);
                 let pageToLoad = 'statistikaPage';
                if (currentHash) {
                    const targetLink = document.querySelector(`.navLink[href="#${currentHash}"]`);
                    if (targetLink) {
                        pageToLoad = targetLink.dataset.page;
                    } else {
                        // Əgər hash uyğun deyilsə, default səhifəyə yönləndir və URL-i dəyiş
                        history.replaceState(null, '', '#statistika');
                    }
                } else {
                     history.replaceState(null, '', '#statistika'); // Əgər hash yoxdursa, əlavə et
                }
                sehifeGoster(pageToLoad);
            }


            // Mobil Menyunu Aç/Bağla
            menuToggleBtn.addEventListener('click', function() {
                sidebarMenu.classList.toggle('menuVisible');
                // Main content-in marginini tənzimlə
                if (sidebarMenu.classList.contains('menuVisible')) {
                    mainContentContainer.style.marginLeft = '260px'; // Bu dəyər sidebar genişliyi ilə eyni olmalıdır
                } else {
                    mainContentContainer.style.marginLeft = '0px';
                }
            });

            // AI Köməkçi
            aiKomekciBtn.addEventListener('click', function() {
                aiKomekciPenceresi.classList.toggle('goster');
                if (aiKomekciPenceresi.classList.contains('goster')) {
                    aiMeslehetiniGuncelle();
                }
            });

            function aiMeslehetiniGuncelle() {
                const aktivSehifeElementi = document.querySelector('.pageContent.active');
                const aktivSehifeId = aktivSehifeElementi ? aktivSehifeElementi.id : null;
                let meslehetHtml = '';

                if (xerclikler.length === 0) {
                    meslehetHtml = "<p>Hələ heç bir xərc əlavə etməmisiniz. Xərclərinizi əlavə etdikdən sonra sizə daha uyğun məsləhətlər verə bilərəm.</p>";
                    aiMeslehetKontent.innerHTML = meslehetHtml;
                    return;
                }

                // Kateqoriyalara görə xərcləri hesabla
                const kateqoriyaXercleri = {};
                let umumiXerc = 0;
                xerclikler.forEach(xerc => {
                    const miqdar = parseFloat(xerc.miqdar);
                    umumiXerc += miqdar;
                    kateqoriyaXercleri[xerc.kateqoriya] = (kateqoriyaXercleri[xerc.kateqoriya] || 0) + miqdar;
                });

                meslehetHtml += "<p><strong>Xərc Paylanması:</strong></p><ul>";
                for (const kat in kateqoriyaXercleri) {
                    const faiz = ((kateqoriyaXercleri[kat] / umumiXerc) * 100).toFixed(1);
                    meslehetHtml += `<li>${kat.charAt(0).toUpperCase() + kat.slice(1)}: ${kateqoriyaXercleri[kat].toFixed(2)} AZN (${faiz}%)</li>`;
                }
                meslehetHtml += "</ul><br>";

                // Ən çox xərclənən kateqoriyanı tap
                let enCoxXercKat = null;
                let maxKatXerc = 0;
                for (const kat in kateqoriyaXercleri) {
                    if (kateqoriyaXercleri[kat] > maxKatXerc) {
                        maxKatXerc = kateqoriyaXercleri[kat];
                        enCoxXercKat = kat;
                    }
                }

                if (enCoxXercKat) {
                    meslehetHtml += `<p>Görünür, ən çox xərci <strong>${enCoxXercKat.charAt(0).toUpperCase() + enCoxXercKat.slice(1)}</strong> kateqoriyasına edirsiniz.</p>`;
                    switch (enCoxXercKat) {
                        case 'qida':
                            meslehetHtml += "<p><strong>Qida xərclərini azaltmaq üçün:</strong></p><ul>";
                            meslehetHtml += "<li>Alış-veriş siyahısı ilə marketə gedin və impulsiv alışlardan çəkinin.</li>";
                            meslehetHtml += "<li>Mövsümi meyvə-tərəvəzlərə üstünlük verin, onlar adətən daha ucuz olur.</li>";
                            meslehetHtml += "<li>Həftəlik yemək planı hazırlayın və evdə daha çox bişirin.</li>";
                            meslehetHtml += "<li>Restoran və kafe xərclərinizi məhdudlaşdırın.</li></ul>";
                            break;
                        case 'neqliyyat':
                            meslehetHtml += "<p><strong>Nəqliyyat xərclərini azaltmaq üçün:</strong></p><ul>";
                            meslehetHtml += "<li>Mümkünsə ictimai nəqliyyatdan daha çox istifadə edin.</li>";
                            meslehetHtml += "<li>Qısa məsafələrə piyada gedin və ya velosiped sürün.</li>";
                            meslehetHtml += "<li>Avtomobiliniz varsa, yanacağa qənaət edən sürmə texnikalarını öyrənin və mütəmadi texniki baxışdan keçirin.</li>";
                            meslehetHtml += "<li>Yanacaq qiymətlərini müqayisə edin.</li></ul>";
                            break;
                        case 'eylence':
                            meslehetHtml += "<p><strong>Əyləncə xərclərini azaltmaq üçün:</strong></p><ul>";
                            meslehetHtml += "<li>Ödənişli əyləncələr əvəzinə pulsuz və ya daha ucuz alternativlər axtarın (məsələn, parkda gəzinti, evdə film izləmək).</li>";
                            meslehetHtml += "<li>Abunəliklərinizi (Netflix, Spotify və s.) gözdən keçirin, ehtiyac olmayanları ləğv edin.</li>";
                            meslehetHtml += "<li>Dostlarla evdə yığışmaq bahalı məkanlara getməkdən daha sərfəli ola bilər.</li></ul>";
                            break;
                        case 'kommunal':
                            meslehetHtml += "<p><strong>Kommunal xərcləri azaltmaq üçün:</strong></p><ul>";
                            meslehetHtml += "<li>İstifadə etmədiyiniz zaman işıqları və elektrik cihazlarını söndürün.</li>";
                            meslehetHtml += "<li>Su sızmalarını dərhal təmir edin.</li>";
                            meslehetHtml += "<li>Enerjiyə qənaət edən lampalardan (LED) istifadə edin.</li>";
                            meslehetHtml += "<li>Qışda otaqların temperaturunu bir az aşağı salmaqla qaz sərfiyyatını azalda bilərsiniz.</li></ul>";
                            break;
                        default:
                            meslehetHtml += `<p><strong>${enCoxXercKat.charAt(0).toUpperCase() + enCoxXercKat.slice(1)} xərclərinizi azaltmaq üçün</strong> ümumi büdcə planlaması edin və zəruri olmayan alışları azaldın.</p>`;
                    }
                } else if (xerclikler.length > 0) {
                     meslehetHtml += "<p>Xərcləriniz müxtəlif kateqoriyalara yayılıb. Ümumi qənaət üçün aylıq büdcənizi diqqətlə planlayın və hər kateqoriyada kiçik kəsirlər etməyə çalışın.</p>";
                }


                if (aktivSehifeId === 'xercleriAzaltPage') {
                    meslehetHtml += "<br><p>Hazırda <strong>Xərcləri Azaltmaq Yolları</strong> səhifəsindəsiniz. Buradakı məsləhətləri oxumağınız faydalı ola bilər.</p>";
                }

                aiMeslehetKontent.innerHTML = meslehetHtml;
            }

            // Responsive dizayn üçün pəncərə ölçüsü dəyişdikdə
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    sidebarMenu.classList.remove('menuVisible'); // Böyük ekranda toggle düyməsinin effekti qalmasın
                    mainContentContainer.style.marginLeft = '260px'; // Sidebar açıqdır
                } else {
                    // Əgər menyu açıq deyilsə, margin 0 olmalıdır
                    if (!sidebarMenu.classList.contains('menuVisible')) {
                         mainContentContainer.style.marginLeft = '0px';
                    }
                }
            });

            // Chart.js üçün qrafik
            let xerclikQrafikiInstance = null;
            function xerclikQrafikiGuncelle(kateqoriyaXercleri) {
                const ctx = document.getElementById('xerclikQrafiki').getContext('2d');
                const labels = Object.keys(kateqoriyaXercleri).map(kat => kat.charAt(0).toUpperCase() + kat.slice(1));
                const data = Object.values(kateqoriyaXercleri);

                // Rəng palitrası
                const backgroundColors = [
                    'rgba(54, 162, 235, 0.7)', // Mavi
                    'rgba(255, 99, 132, 0.7)',  // Çəhrayı
                    'rgba(75, 192, 192, 0.7)',  // Yaşıl-mavi
                    'rgba(255, 206, 86, 0.7)',  // Sarı
                    'rgba(153, 102, 255, 0.7)', // Bənövşəyi
                    'rgba(255, 159, 64, 0.7)',  // Narıncı
                    'rgba(199, 199, 199, 0.7)', // Boz
                    'rgba(83, 109, 254, 0.7)'   // İndigo
                ];
                const borderColors = backgroundColors.map(color => color.replace('0.7', '1'));


                if (xerclikQrafikiInstance) {
                    xerclikQrafikiInstance.destroy(); // Əvvəlki qrafiki məhv et
                }

                if (labels.length === 0) { // Əgər data yoxdursa qrafiki göstərmə
                     document.getElementById('xerclikQrafiki').style.display = 'none';
                     return;
                }
                 document.getElementById('xerclikQrafiki').style.display = 'block';


                xerclikQrafikiInstance = new Chart(ctx, {
                    type: 'doughnut', // və ya 'pie', 'bar'
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Xərclər (AZN)',
                            data: data,
                            backgroundColor: backgroundColors.slice(0, data.length),
                            borderColor: borderColors.slice(0, data.length),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Xərclərin Kateqoriyalara Görə Paylanması'
                            }
                        }
                    }
                });
            }

            // Cədvəl üçün axtarış
            cedvelAxtarisInput.addEventListener('input', function() {
                const filteredData = getFilteredData();
                xerclikCedveliniYenile(filteredData);
            });


            // İlkin yükləmələr
            baslangicSehifesiniYukle(); // URL hash-ə görə səhifəni yüklə
            balansYenile();
            xerclikCedveliniYenile();
            statistikaYenile();

            // Xərclik əlavə etmə səhifəsindəki tarix inputuna bugünkü tarixi default olaraq ver
            if(xerclikTarixInput) {
                xerclikTarixInput.valueAsDate = new Date();
            }

        });
    </script>
</body>
</html>

